<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SLV Project: Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root {
            /* --- PALETTE --- */
            --bg-color: #0a0e17; --card-bg: #111620;
            --primary: #4CC9F0; --secondary: #7209B7; --text: #ffffff;
            --success: #06D6A0; --danger: #EF476F; --warning: #FFD166;
            --code-color: #B5179E; --sport-color: #F4A261; --fizz-color: #FFB703; --water-color: #4895EF;
            --sleep-color: #4361ee; --air-color: #00B4D8;
            --soul-color: #E0AAFF; --shadow-color: #6C757D; --fire-color: #ff5400; --notes-color: #F0E68C;
            --lock-color: #ff0055;
            --nutri-protein: #EF476F; --nutri-vege: #06D6A0; --nutri-carbs: #FFD166; --nutri-fats: #118AB2; --nutri-calcium: #EDF2F4;
            --hud-line: rgba(76, 201, 240, 0.3);
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text); margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* AUTH SCREEN */
        #auth-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg-color); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; box-sizing: border-box; }
        .google-btn { background: white; color: #444; border: none; padding: 15px 30px; font-size: 1.2em; font-weight: bold; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(255,255,255,0.2); transition: 0.2s; }
        .google-btn:active { transform: scale(0.95); }

        /* FX */
        .floating-xp { position: absolute; font-weight: bold; font-size: 1.2em; pointer-events: none; animation: floatUp 1s ease-out forwards; z-index: 9999; text-shadow: 0 0 5px rgba(0,0,0,0.8); }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 50% { opacity: 1; transform: translateY(-20px) scale(1.2); } 100% { opacity: 0; transform: translateY(-40px) scale(1); } }
        .particle { position: absolute; width: 6px; height: 6px; border-radius: 50%; pointer-events: none; z-index: 9998; animation: particleFade 0.8s ease-out forwards; }
        @keyframes particleFade { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }
        .task-item input:checked { animation: pulseCheck 0.3s cubic-bezier(0.17, 0.67, 0.43, 1.65); }
        @keyframes pulseCheck { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

        /* WHEEL OF FORTUNE */
        .wheel-wrapper { position: relative; width: 280px; height: 280px; margin: 10px auto; display: flex; justify-content: center; align-items: center; }
        .wheel-canvas { width: 100%; height: 100%; border-radius: 50%; box-shadow: 0 0 15px rgba(255, 183, 3, 0.2); transform: rotate(0deg); }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 20px solid var(--danger); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)); z-index: 10; }
        .wheel-center { position: absolute; width: 40px; height: 40px; background: #222; border: 2px solid var(--fizz-color); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: 1.2em; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 5; }

        /* HUD */
        .hud-container { width: 100%; height: 450px; position: relative; background: radial-gradient(circle at center, #1a2233 0%, #0a0e17 100%); border-radius: 15px; border: 1px solid #333; margin-bottom: 20px; overflow: hidden; background-image: linear-gradient(rgba(76, 201, 240, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(76, 201, 240, 0.1) 1px, transparent 1px); background-size: 40px 40px; }
        .avatar-img { height: 90%; width: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2; filter: drop-shadow(0 0 20px rgba(76, 201, 240, 0.2)); transition: 0.5s; }
        .hud-bar-container { position: absolute; top: 50px; left: 20px; width: 12px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 6px; z-index: 3; border: 1px solid rgba(255,255,255,0.2); }
        .hud-bar-fill { width: 100%; height: 0%; background: linear-gradient(to top, var(--primary), var(--success)); border-radius: 6px; position: absolute; bottom: 0; transition: height 1s ease; box-shadow: 0 0 10px var(--primary); }
        .hud-label-left { position: absolute; top: 25px; left: 20px; font-size: 0.6em; color: #aaa; letter-spacing: 1px; }
        .hud-score-text { position: absolute; top: 120px; left: 40px; font-size: 1.2em; color: var(--primary); font-weight: bold; }
        .hud-line { position: absolute; background: var(--hud-line); z-index: 1; }
        .hl-1 { width: 100px; height: 1px; top: 250px; left: 32px; } .hl-2 { width: 1px; height: 50px; top: 200px; left: 32px; }
        .hud-label-right { position: absolute; right: 20px; text-align: right; z-index: 3; }
        .hl-title { font-size: 0.7em; color: var(--primary); letter-spacing: 1px; margin-bottom: 2px; }
        .hl-val { font-size: 1.1em; font-weight: bold; color: white; text-shadow: 0 0 5px white; }
        .hud-footer { position: absolute; bottom: 20px; left: 20px; z-index: 3; }
        .hf-title { font-size: 0.8em; color: white; letter-spacing: 1px; font-weight: bold; }
        .hf-sub { font-size: 0.7em; color: var(--primary); letter-spacing: 1px; }

        /* UI Structure */
        .header { padding: 20px; background: linear-gradient(135deg, #1a1a1a, #000); border-bottom: 2px solid var(--primary); flex-shrink: 0; display:flex; justify-content:space-between; align-items:center; }
        .level-info { font-size: 1.2em; font-weight: bold; }
        .xp-bar-container { width: 100%; height: 10px; background-color: #333; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .xp-bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%; transition: width 0.5s ease; }
        .nav { display: flex; justify-content: space-around; background-color: var(--card-bg); padding: 10px 0; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #333; z-index: 100; }
        .nav-btn { background: none; border: none; color: #666; font-size: 1.4em; cursor: pointer; padding: 5px 15px; border-radius: 10px; transition: all 0.2s; }
        .nav-btn.active { color: var(--primary); background-color: rgba(76, 201, 240, 0.15); }
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px; }
        .screen { display: none; animation: fadeIn 0.3s; } .screen.active { display: block; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background-color: var(--card-bg); border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border-left: 4px solid var(--primary); } .card h3 { margin-top: 0; color: var(--primary); }
        
        /* Specific Cards */
        .water-card { border-left-color: var(--water-color); } .water-progress-bg { width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin: 10px 0; position: relative; } .water-progress-fill { height: 100%; background: var(--water-color); width: 0%; transition: width 0.5s ease; } .water-text { position: absolute; width: 100%; text-align: center; font-size: 0.8em; line-height: 20px; color: white; text-shadow: 0 0 3px #000; } .water-controls { display: flex; gap: 5px; justify-content: space-between; margin-top: 10px; } .water-btn { flex: 1; background: rgba(72, 149, 239, 0.2); border: 1px solid var(--water-color); color: var(--water-color); padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.9em; } .water-btn-neg { flex: 1; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 5px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.8em; }
        .air-card { border-left-color: var(--air-color); } .air-progress-bg { width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin: 10px 0; position: relative; } .air-progress-fill { height: 100%; background: var(--air-color); width: 0%; transition: width 0.5s ease; } .air-text { position: absolute; width: 100%; text-align: center; font-size: 0.8em; line-height: 20px; color: white; text-shadow: 0 0 3px #000; } .air-controls { display: flex; gap: 5px; justify-content: space-between; margin-top: 10px; } .air-btn { flex: 1; background: rgba(0, 180, 216, 0.2); border: 1px solid var(--air-color); color: var(--air-color); padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.9em; } .air-btn-neg { flex: 1; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 5px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.8em; }
        .sleep-card { border-left-color: var(--sleep-color); } .sleep-inputs { display: flex; gap: 15px; margin-bottom: 10px; } .sleep-field { flex: 1; } .sleep-label { font-size: 0.8em; color: #aaa; display: block; margin-bottom: 5px; } .sleep-time-input { width: 100%; background: #333; border: 1px solid #555; color: white; padding: 8px; border-radius: 8px; box-sizing: border-box; font-family: inherit; } .sleep-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; } .sleep-result { font-weight: bold; font-size: 1.1em; color: var(--sleep-color); } .sleep-save-btn { background: var(--sleep-color); color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .energy-status { font-weight: bold; color: var(--warning); margin-left: 10px; } .energy-btn { width: 100%; background: #333; border: 1px solid var(--warning); color: var(--warning); padding: 8px; border-radius: 8px; margin-top: 10px; cursor: pointer; font-weight: bold; } .energy-log { margin-top: 15px; font-size: 0.9em; color: #aaa; border-top: 1px solid #333; padding-top: 10px; } .energy-log-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .nutri-row { margin-bottom: 15px; } .nutri-label { display: flex; justify-content: space-between; font-size: 0.9em; margin-bottom: 5px; } .nutri-bar-bg { width: 100%; height: 10px; background: #333; border-radius: 5px; overflow: hidden; } .nutri-bar-fill { height: 100%; width: 0%; transition: width 0.3s; } .nutri-controls { display: flex; justify-content: flex-end; gap: 8px; margin-top: 5px; } .nutri-btn { background: #333; border: 1px solid #555; color: white; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em; } .nutri-btn:active { background: #555; } .btn-minus { border-color: var(--danger); color: var(--danger); }
        .nutri-help-header { background: #252525; padding: 10px; border-radius: 8px; margin-top: 15px; display: flex; justify-content: space-between; cursor: pointer; border: 1px solid #333; } .nutri-help-content { display: none; background: #222; padding: 10px; border-radius: 0 0 8px 8px; margin-top: -5px; border: 1px solid #333; border-top: none; font-size: 0.9em; } .nutri-help-item { margin-bottom: 8px; } .nutri-help-title { font-weight: bold; display: block; margin-bottom: 2px; } .nutri-help-list { color: #aaa; font-style: italic; }
        .sport-card { border-left-color: var(--sport-color); } .fizz-card { border-left-color: var(--fizz-color); } .sport-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: #222; padding: 10px; border-radius: 8px; } .sport-controls { display: flex; align-items: center; gap: 5px; } .sport-btn { background: #444; border: none; color: white; width: 30px; height: 30px; border-radius: 5px; font-weight: bold; cursor: pointer; } .sport-input { width: 50px; background: #111; border: 1px solid #333; color: var(--sport-color); text-align: center; padding: 5px; border-radius: 5px; font-weight: bold; }
        .fizz-btn { width: 100%; background: var(--fizz-color); color: black; border: none; padding: 15px; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 10px; } .fizz-result { background: #222; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--fizz-color); display: none; animation: fadeIn 0.5s; } .fizz-done-btn { background: var(--success); border: none; padding: 8px 20px; color: black; font-weight: bold; border-radius: 5px; cursor: pointer; }
        .accordion-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; } .accordion-content { display: none; margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; animation: slideDown 0.3s ease-out; } .accordion-content.open { display: block; } @keyframes slideDown { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: translateY(0); } }
        .task-item { display: flex; align-items: center; margin-bottom: 12px; background: #252525; padding: 12px; border-radius: 8px; transition: background 0.3s; } .task-item input { margin-right: 15px; width: 22px; height: 22px; accent-color: var(--primary); cursor: pointer; } .task-item label { font-size: 1em; flex: 1; cursor: pointer; } .task-item.completed { opacity: 0.6; background: #1a1a1a; text-decoration: line-through; }
        .btn-block { display: block; width: 100%; padding: 12px; margin-bottom: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1em; } .btn-save { background: var(--success); color: #000; } .btn-load { background: var(--primary); color: #000; } .btn-reset { background: #333; color: var(--danger); border: 1px solid var(--danger); } .btn-notify { background: var(--warning); color: black; } .btn-soft-reset { background: #333; color: var(--warning); border: 1px solid var(--warning); } .btn-hard-reset { background: #333; color: var(--danger); border: 1px solid var(--danger); margin-top: 20px;}
        .secret-bg { background-color: #050505; } .card-soul { border-left-color: var(--soul-color); } .card-shadow { border-left-color: var(--shadow-color); } .card-notes { border-left-color: var(--notes-color); }
        .secret-title-input { width: 100%; background: #222; color: white; border: 1px solid #444; border-radius: 8px; padding: 10px; margin-bottom: 5px; box-sizing: border-box; font-weight: bold; } .secret-textarea { width: 100%; background: #222; color: white; border: 1px solid #444; border-radius: 8px; padding: 10px; min-height: 60px; margin-bottom: 10px; resize: vertical; font-family: inherit; box-sizing: border-box; } .secret-btn-save { width: 100%; background: #333; border: 1px solid var(--notes-color); color: var(--notes-color); padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .note-item { background: #222; border-radius: 8px; border-left: 3px solid var(--notes-color); margin-bottom: 10px; overflow: hidden; } .note-header { padding: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #2a2a2a; } .note-title-text { font-weight: bold; font-size: 1em; color: var(--notes-color); } .note-date { font-size: 0.7em; color: #888; display: block; margin-top: 2px; } .note-body { display: none; padding: 10px; border-top: 1px solid #333; white-space: pre-wrap; color: #ddd; font-size: 0.95em; line-height: 1.4; animation: slideDown 0.2s ease-out; } .note-body.open { display: block; } .note-arrow { color: #666; font-size: 0.8em; margin-right: 10px; } .note-delete { color: var(--danger); background: none; border: none; font-size: 1.2em; cursor: pointer; padding: 0 5px; }
        .streak-box { display: flex; justify-content: space-between; background: #151515; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; } .streak-item { text-align: center; flex: 1; } .streak-val { font-size: 1.5em; font-weight: bold; color: var(--text); } .streak-label { font-size: 0.8em; color: #888; } .fire-icon { color: var(--fire-color); text-shadow: 0 0 10px var(--fire-color); } .best-icon { color: var(--warning); }
        .secret-input-row { display: flex; gap: 10px; margin-top: 10px; } .secret-input { flex: 1; background: #222; border: 1px solid #444; color: white; padding: 8px; border-radius: 5px; } .secret-btn-add { background: #444; color: white; border: none; padding: 0 15px; border-radius: 5px; cursor: pointer; font-weight: bold;}
        #vault-door { text-align: center; padding: 20px; margin-top: 50px; } .vault-icon { font-size: 4em; margin-bottom: 20px; display: block; } .vault-input { background: #222; border: 2px solid var(--lock-color); color: white; padding: 15px; border-radius: 10px; font-size: 1.2em; text-align: center; width: 80%; margin-bottom: 20px; } .vault-btn { background: var(--lock-color); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 80%; } #vault-content { display: none; }
        .editor-input { width: 100%; padding: 12px; background: #333; border: 1px solid #444; color: white; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; font-size: 1em; } .editor-row { display: flex; gap: 10px; margin-bottom: 10px; } .btn-add { width: 100%; background: var(--primary); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; } .edit-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; } .edit-controls { display: flex; gap: 10px; } .btn-icon { background: none; border: none; font-size: 1.2em; cursor: pointer; padding: 5px; } .btn-delete { color: var(--danger); } .btn-edit { color: var(--warning); }
        .date-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #111; padding: 5px; border-radius: 10px; border: 1px solid #333; } .date-nav button { background: var(--primary); border: none; color: #000; font-weight: bold; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; } .date-input { background: transparent; border: none; color: white; font-size: 1.1em; font-family: 'Segoe UI', sans-serif; font-weight: bold; text-align: center; cursor: pointer; color-scheme: dark; } .history-stat-box { text-align: center; padding: 15px; background: rgba(0, 229, 255, 0.1); border-radius: 10px; margin-bottom: 15px; border: 1px solid var(--primary); } .history-stat-val { font-size: 2em; font-weight: bold; color: var(--success); } .history-section-title { font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .chart-controls { display: flex; gap: 10px; margin-bottom: 15px; } .chart-btn { flex: 1; padding: 8px; background: #333; border: 1px solid #444; color: #aaa; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: 0.2s; } .chart-btn.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; } .chart-container { background: #1a1a1a; padding: 10px; border-radius: 10px; height: 300px; position: relative; }
        .masters-grid { display: grid; gap: 10px; } .master-card { border-left: 4px solid var(--secondary); background: var(--card-bg); padding: 15px; border-radius: 15px; } .master-code { border-left: 4px solid var(--code-color); background: var(--card-bg); padding: 15px; border-radius: 15px; } .master-row { display: flex; align-items: center; } .master-avatar { width: 50px; height: 50px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center; font-size: 1.5em; margin-right: 15px; }
        .task-tabs { display: flex; gap: 5px; margin-bottom: 10px; background: #1a1a1a; padding: 5px; border-radius: 8px; }
        .task-tab-btn { flex: 1; background: none; border: none; color: #666; padding: 8px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 0.9em; transition: 0.2s; }
        .task-tab-btn.active { background: #333; color: var(--primary); }
        .task-list-container { display: none; }
        .task-list-container.active { display: block; animation: fadeIn 0.3s; }
        .tab-mind.active { color: var(--soul-color); }
        .tab-chores.active { color: var(--danger); }
        .user-email-display { font-size: 0.7em; color: #666; margin-left: 10px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <h1 style="color:var(--primary); font-size:3em; margin-bottom:10px;">SLV</h1>
        <p style="color:#888; margin-bottom:40px;">–°—Ç–∞–ª –õ—É—á—à–µ –ß–µ–º –í—á–µ—Ä–∞</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="24" height="24">
            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
        </button>
        <p style="margin-top:20px; font-size:0.8em; color:#555;">Cloud Sync Active</p>
    </div>

    <div class="header">
        <div>
            <div class="level-info"><span id="userLevel">–£—Ä–æ–≤–µ–Ω—å 1</span><span id="xpText">0 XP</span></div>
            <div class="xp-bar-container"><div class="xp-bar-fill" id="xpBar"></div></div>
        </div>
        <div style="text-align: right;">
             <div style="font-size: 0.8em; color: #888; cursor: pointer;" onclick="headerClick()" id="appTitle">SLV: Cloud</div>
             <div id="currentUserEmail" class="user-email-display"></div>
        </div>
    </div>

    <div class="content">
        <div id="screen-dash" class="screen active">
            <h2>üìÖ SLV: –ú–æ–π –î–µ–Ω—å</h2>
            
            <div class="card" style="border-left-color: var(--warning);"><h3 style="color:var(--warning); margin-bottom:10px;">üîã –ú–æ—è –≠–Ω–µ—Ä–≥–∏—è</h3><label>–£—Ä–æ–≤–µ–Ω—å: <span id="energyVal" style="font-weight:bold; color:var(--warning);">5</span> <span id="energyText" class="energy-status">üòê –ù–æ—Ä–º–∞</span></label><input type="range" min="1" max="10" value="5" style="width:100%; margin-top:10px;" class="energy-range" oninput="updateEnergyUI(this.value)"><button class="energy-btn" onclick="logEnergy()">‚è± –ó–∞–ø–∏—Å–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button><div id="energyLog" class="energy-log"></div></div>

            <div class="card sleep-card">
                <h3 style="color:var(--sleep-color); margin-top:0;">üí§ –°–æ–Ω (–†–µ–∂–∏–º)</h3>
                <div class="sleep-inputs"><div class="sleep-field"><span class="sleep-label">üåô –õ—ë–≥ —Å–ø–∞—Ç—å</span><input type="time" id="sleepStart" class="sleep-time-input"></div><div class="sleep-field"><span class="sleep-label">‚òÄÔ∏è –í—Å—Ç–∞–ª</span><input type="time" id="sleepEnd" class="sleep-time-input"></div></div>
                <div class="sleep-footer"><span id="sleepResultDisplay" class="sleep-result">-- —á -- –º–∏–Ω</span><button class="sleep-save-btn" onclick="saveSleep()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
            </div>

            <div class="card water-card">
                <div style="display:flex; justify-content:space-between;"><h3 style="margin:0; color:var(--water-color);">üíß –ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è</h3><span id="waterGoalDisplay" style="color:#888; font-size:0.9em;">–¶–µ–ª—å: 0 –º–ª</span></div>
                <div class="water-progress-bg"><div class="water-progress-fill" id="waterBar"></div><div class="water-text"><span id="waterCurrent">0</span> –º–ª</div></div>
                <div class="water-controls"><button class="water-btn" onclick="addWater(200)">+200</button><button class="water-btn" onclick="addWater(300)">+300</button><button class="water-btn" onclick="addWater(500)">+500</button></div>
                <div class="water-controls" style="margin-top:5px;"><button class="water-btn-neg" onclick="addWater(-150)">-150</button><button class="water-btn-neg" onclick="addWater(-250)">-250</button></div>
            </div>

            <div class="card" style="border-left-color: var(--nutri-vege);">
                <div class="accordion-header" onclick="toggleNutri()"><h3 style="color:var(--nutri-vege); margin:0;">üß¨ –ù—É—Ç—Ä–∏-–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h3><span id="nutriArrow">‚ñº</span></div>
                <div class="accordion-content" id="nutriContent">
                    <div id="nutriList"></div>
                    <div class="nutri-help-header" onclick="toggleNutriHelp()"><span style="color:var(--primary); font-weight:bold;">üìñ –ß—Ç–æ –∫ —á–µ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è?</span><span id="nutriHelpArrow">‚ñº</span></div>
                    <div class="nutri-help-content" id="nutriHelpContent">
                        <div class="nutri-help-item"><span class="nutri-help-title" style="color:var(--nutri-protein)">ü•© –ë–µ–ª–æ–∫</span><span class="nutri-help-list">–ú—è—Å–æ, –†—ã–±–∞, –Ø–π—Ü–∞, –¢–≤–æ—Ä–æ–≥.</span></div>
                        <div class="nutri-help-item"><span class="nutri-help-title" style="color:var(--nutri-vege)">ü•¶ –ó–µ–ª–µ–Ω—å</span><span class="nutri-help-list">–û–≥—É—Ä—Ü—ã, –°–∞–ª–∞—Ç, –ö–∞–ø—É—Å—Ç–∞.</span></div>
                        <div class="nutri-help-item"><span class="nutri-help-title" style="color:var(--nutri-carbs)">üîã –£–≥–ª–∏</span><span class="nutri-help-list">–ì—Ä–µ—á–∫–∞, –†–∏—Å, –•–ª–µ–±.</span></div>
                        <div class="nutri-help-item"><span class="nutri-help-title" style="color:var(--nutri-fats)">ü•ë –ñ–∏—Ä—ã</span><span class="nutri-help-list">–ú–∞—Å–ª–æ, –°–º–µ—Ç–∞–Ω–∞, –û—Ä–µ—Ö–∏.</span></div>
                        <div class="nutri-help-item"><span class="nutri-help-title" style="color:var(--nutri-calcium)">ü¶¥ –ö–∞–ª—å—Ü–∏–π</span><span class="nutri-help-list">–¢–≤–æ—Ä–æ–≥, –°—ã—Ä, –ú–æ–ª–æ–∫–æ.</span></div>
                    </div>
                </div>
            </div>
            
            <div class="card air-card">
                <div style="display:flex; justify-content:space-between;"><h3 style="margin:0; color:var(--air-color);">üå¨Ô∏è –í–æ–∑–¥—É—Ö / –£–ª–∏—Ü–∞</h3><span id="airGoalDisplay" style="color:#888; font-size:0.9em;">–¶–µ–ª—å: 60 –º–∏–Ω</span></div>
                <div class="air-progress-bg"><div class="air-progress-fill" id="airBar"></div><div class="air-text"><span id="airCurrent">0</span> –º–∏–Ω</div></div>
                <div class="air-controls"><button class="air-btn" onclick="addAir(15)">+15</button><button class="air-btn" onclick="addAir(30)">+30</button><button class="air-btn" onclick="addAir(60)">+1 —á–∞—Å</button></div>
                <div class="air-controls" style="margin-top:5px;"><button class="air-btn-neg" onclick="addAir(-15)">-15</button><button class="air-btn-neg" onclick="addAir(-30)">-30</button></div>
            </div>

            <div class="card">
                <div class="accordion-header" onclick="toggleTasks()">
                    <h3 style="margin:0; color:var(--primary);">üöÄ –ó–∞–¥–∞—á–∏ & –ö–≤–µ—Å—Ç—ã</h3>
                    <span id="tasksArrow">‚ñ≤</span>
                </div>
                <div class="accordion-content open" id="tasksContent">
                    <div class="task-tabs">
                        <button class="task-tab-btn active" onclick="switchTaskTab('daily', this)">üìÖ –ï–∂–µ–¥–Ω–µ–≤–∫–∏</button>
                        <button class="task-tab-btn tab-mind" onclick="switchTaskTab('mind', this)">üëÅÔ∏è –°–æ–∑–Ω–∞–Ω–∏–µ</button>
                        <button class="task-tab-btn tab-chores" onclick="switchTaskTab('chores', this)">üßπ –ö–æ–Ω—á—É–≥–∏</button>
                    </div>
                    
                    <div id="tab-daily" class="task-list-container active"><div id="dailyTasks"></div></div>
                    <div id="tab-mind" class="task-list-container">
                        <div style="color:#aaa; font-size:0.8em; margin-bottom:10px;">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –º–æ–∑–≥–∞.</div>
                        <div id="mindTasks"></div>
                    </div>
                    <div id="tab-chores" class="task-list-container">
                        <div style="color:#aaa; font-size:0.8em; margin-bottom:10px;">–ë—ã—Ç–æ–≤—É—Ö–∞ –∏ —Ä–∞–∑–æ–≤—ã–µ –ø–æ—Ä—É—á–µ–Ω–∏—è. –í—ã–ø–æ–ª–Ω–∏–ª ‚Äî –∏—Å—á–µ–∑–ª–∏.</div>
                        <div id="choreTasks"></div>
                    </div>
                </div>
            </div>

            <div class="card sport-card"><div class="accordion-header" onclick="toggleSport()"><h3 style="margin:0; color:var(--sport-color);">ü•ã –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ë–∏–º–ü–∞—Å—Ç–∞</h3><span id="sportArrow">‚ñº</span></div><div class="accordion-content" id="sportContent"><div id="sportList"></div><p style="color:#666; font-size:0.8em; text-align:center; margin-top:10px;">–í–≤–æ–¥–∏ –∫–æ–ª-–≤–æ —Ä–∞–∑.</p></div></div>
            
            <div class="card fizz-card">
                <h3 style="color:var(--fizz-color); margin-bottom:15px;">‚ö° –§–∏–∑–∫—É–ª—å—Ç-–º–∏–Ω—É—Ç–∫–∞</h3>
                <div class="wheel-wrapper"><div class="wheel-pointer"></div><div class="wheel-center">üé≤</div><canvas id="fizzWheel" class="wheel-canvas" width="280" height="280"></canvas></div>
                <button class="fizz-btn" onclick="spinWheel()">üé° –ö—Ä—É—Ç–∏—Ç—å –ë–∞—Ä–∞–±–∞–Ω!</button>
                <div id="fizzResult" class="fizz-result">
                    <div style="font-size:3em; margin-bottom:10px;">ü§∏‚Äç‚ôÇÔ∏è</div><h4 id="fizzName">–†–µ–∑-—Ç</h4><p id="fizzXP" style="color:#888; margin-bottom:15px;">+ XP</p>
                    <div id="fizzTimerDisplay" style="font-size: 2.5em; font-weight: bold; color: var(--fizz-color); margin-bottom: 15px; display: none; font-family: monospace;">05:00</div>
                    <button id="btnStartTimer" class="fizz-btn" style="background: #333; color: var(--fizz-color); border: 1px solid var(--fizz-color); font-size:0.9em;" onclick="startFizzTimer()">‚è± –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä (5 –º–∏–Ω)</button>
                    <button id="btnFizzDone" class="fizz-done-btn" onclick="completeFizz()" disabled style="opacity: 0.5; cursor: not-allowed;">‚úÖ –ì–æ—Ç–æ–≤–æ</button>
                </div>
            </div>
        </div>

        <div id="screen-bogdan" class="screen"><h2>üë¶ –ë–æ–≥–¥–∞–ΩTime</h2><div class="card" style="border-left-color: #00ff9d;"><h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3><div id="bogdanTasks"></div></div><div class="card"><h3>üé≤ –ò–¥–µ–∏</h3><ul style="padding-left: 20px; color: #aaa;"><li>‚ôüÔ∏è –®–∞—Ö–º–∞—Ç—ã</li><li>ü•ã –ö–∞–ø–æ—ç–π—Ä–∞</li><li>üíª Scratch</li><li>üé∏ –ì–∏—Ç–∞—Ä–∞</li><li>üé¨ –ú–æ–Ω—Ç–∞–∂</li></ul></div></div>

        <div id="screen-stats" class="screen">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="card" style="text-align:center; border-left-color: #fff;">
                <h3 style="color:#fff; margin-bottom:5px; font-size:1em;">üÜö –ë–∏—Ç–≤–∞ —Å —Å–æ–±–æ–π</h3>
                <div id="compVal" style="font-size: 2.5em; font-weight: bold; color: #888;">--%</div>
                <div id="compText" style="font-size: 0.9em; color: #777;">–ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ –≤—á–µ—Ä–∞—à–Ω–∏–º –¥–Ω–µ–º</div>
            </div>
            <div class="hud-container">
                <div class="hud-label-left">–ë–ê–õ–ê–ù–°</div>
                <div class="hud-bar-container"><div id="hudBalanceBar" class="hud-bar-fill"></div></div>
                <div id="hudBalanceText" class="hud-score-text">0%</div>
                <div class="hud-line hl-1"></div><div class="hud-line hl-2"></div>
                <img id="avatarImage" src="https://i.imgur.com/3u7g4hK.png" class="avatar-img" alt="Bio Status">
                <div class="hud-label-right" style="top: 30px;"><div class="hl-title">–í–û–î–ê</div><div id="hudWaterVal" class="hl-val">0%</div></div>
                <div class="hud-label-right" style="top: 95px;"><div class="hl-title">–°–û–ù</div><div id="hudSleepVal" class="hl-val">--</div></div>
                <div class="hud-label-right" style="top: 160px;"><div class="hl-title">–í–û–ó–î–£–•</div><div id="hudAirVal" class="hl-val">0–º</div></div>
                <div class="hud-label-right" style="top: 225px;"><div class="hl-title">–ü–ò–¢–ê–ù–ò–ï</div><div id="hudNutriVal" class="hl-val">0%</div></div>
                <div class="hud-label-right" style="top: 290px;"><div class="hl-title">–°–ü–û–†–¢</div><div id="hudSportVal" class="hl-val">0</div></div>
                <div class="hud-footer"><div class="hf-title">–°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´</div><div id="hudSystemStatus" class="hf-sub">–ê–ù–ê–õ–ò–ó...</div></div>
            </div>

            <div class="card" style="border-left-color: var(--code-color);"><div class="chart-controls"><button class="chart-btn active" onclick="updateChartPeriod('month', this)">–ú–µ—Å—è—Ü</button><button class="chart-btn" onclick="updateChartPeriod('year', this)">–ì–æ–¥</button><button class="chart-btn" onclick="updateChartPeriod('all', this)">–í—Å—ë –≤—Ä–µ–º—è</button></div><div class="chart-container"><canvas id="xpChart"></canvas></div></div>
            <h3>üìú –î–Ω–µ–≤–Ω–∏–∫ –î–Ω—è</h3>
            <div class="card" style="border-left-color: #fff;"><div class="date-nav"><button onclick="changeHistoryDate(-1)">‚óÄ</button><input type="date" id="historyDateInput" class="date-input" onchange="jumpToDate(this.value)"><button onclick="changeHistoryDate(1)">‚ñ∂</button></div><div class="history-stat-box"><div>–û–ø—ã—Ç:</div><div class="history-stat-val" id="historyXPVal">0 XP</div></div><div id="historyListContainer" style="opacity: 0.9;"></div></div>
        </div>

        <div id="screen-editor" class="screen">
            <h2>üõ† –†–µ–¥–∞–∫—Ç–æ—Ä</h2>
            <div class="card" style="border-left-color: var(--water-color);"><h3 style="color:var(--water-color)">üë§ –ú–æ–∏ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3><label style="color:#aaa; font-size:0.9em;">–í–µ—Å (–∫–≥):</label><div class="editor-row" style="margin-top:5px;"><input type="number" id="userWeight" class="editor-input" placeholder="–ö–≥" onchange="saveWeight(this.value)"></div></div>
            <div class="card fizz-card"><h3 style="color:var(--fizz-color)">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ 5-–º–∏–Ω—É—Ç–∫–∏</h3><div class="editor-row"><input type="text" id="newFizzName" class="editor-input" placeholder="–†–∞–∑–º–∏–Ω–∫–∞"><input type="number" id="newFizzXP" class="editor-input" placeholder="XP" style="width:40%"></div><button class="btn-add" style="background:var(--fizz-color); color:black;" onclick="addNewFizz()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button><div id="editListFizz" style="margin-top:15px;"></div></div>
            <div class="card sport-card"><h3 style="color:var(--sport-color)">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°–ø–æ—Ä—Ç–∞</h3><div class="editor-row"><input type="text" id="newSportName" class="editor-input" placeholder="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ"><input type="number" id="newSportRate" class="editor-input" placeholder="XP –∑–∞ 1 —Ä–∞–∑" style="width:40%"></div><button class="btn-add" style="background:var(--sport-color)" onclick="addNewSport()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button><div id="editListSport" style="margin-top:15px;"></div></div>
            <div class="card" style="border-left-color: #fff;"><h3>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h3><div class="editor-row"><input type="text" id="newTaskName" class="editor-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="width:60%"><input type="number" id="newTaskXP" class="editor-input" placeholder="XP" style="width:40%"></div><select id="targetList" class="editor-input" style="margin-bottom:10px;"><option value="daily">–í –ï–∂–µ–¥–Ω–µ–≤–∫–∏ (–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ)</option><option value="mind">–í –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–∑–Ω–∞–Ω–∏—è (–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ)</option><option value="chores">–í –ö–æ–Ω—á—É–≥–∏ (–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ)</option><option value="bogdan">–í —Å–ø–∏—Å–æ–∫ –ë–æ–≥–¥–∞–ΩTime</option></select><button class="btn-add" onclick="addNewTask()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button></div>
            <div class="card"><h3>–°–ø–∏—Å–æ–∫ SLV</h3><div id="editListSLV"></div></div>
            <div class="card" style="border-left-color: #00ff9d;"><h3>–°–ø–∏—Å–æ–∫ –ë–æ–≥–¥–∞–Ω</h3><div id="editListBogdan"></div></div>
            <div class="card" style="border-left-color: var(--soul-color);"><h3>–°–ø–∏—Å–æ–∫ –°–æ–∑–Ω–∞–Ω–∏–µ</h3><div id="editListMind"></div></div>
            <div class="card" style="border-left-color: var(--danger);"><h3>–°–ø–∏—Å–æ–∫ –ö–æ–Ω—á—É–≥–∏</h3><div id="editListChores"></div></div>
            <br>
            <h2>‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="card" style="border-left-color: #888;">
                <p style="color:var(--warning); font-size:0.8em; text-align:center;">–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –æ–±–ª–∞–∫–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
                <button class="btn-block btn-save" onclick="document.getElementById('fileInput').click()">üì• –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏</button><input type="file" id="fileInput" style="display:none" onchange="importData(this)">
                <button class="btn-block" style="background:#444; color:#fff; border:1px solid #666;" onclick="firebase.auth().signOut()">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            </div>
        </div>

        <div id="screen-masters" class="screen"><h2>üë• –°–æ–≤–µ—Ç –ú–∞—Å—Ç–µ—Ä–æ–≤</h2><div class="masters-grid"><div class="card master-code"><div class="master-row"><div class="master-avatar">üíª</div><div><strong>–¢—É—Ä–í–æ–∑–õ–∏</strong><br><small>–ú–∞—Å—Ç–µ—Ä –ö–æ–¥–∞</small></div></div></div><div class="card master-card"><div class="master-row"><div class="master-avatar">üß†</div><div><strong>–§—Ä–µ–π–¥—É–Ω–≥–ª–æ—É</strong><br><small>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</small></div></div></div><div class="card master-card"><div class="master-row"><div class="master-avatar">üîÆ</div><div><strong>–ù–æ–º–µ—Ä—É—Å</strong><br><small>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è</small></div></div></div><div class="card master-card"><div class="master-row"><div class="master-avatar">‚è±Ô∏è</div><div><strong>–ê–ª—Ç—Ä—ç–π–ø–æ—Ä—Ç</strong><br><small>–¢–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç</small></div></div></div><div class="card master-card"><div class="master-row"><div class="master-avatar">ü•ã</div><div><strong>–ë–∏–º–ü–∞—Å—Ç</strong><br><small>–°–ø–æ—Ä—Ç</small></div></div></div></div></div>

        <div id="screen-secret" class="screen secret-bg">
            <div id="vault-door"><span class="vault-icon">üîê</span><h2 style="color:var(--lock-color)">–¢–∞–π–Ω—ã–π –ë–ª–æ–∫</h2><input type="password" id="vaultPass" class="vault-input" placeholder="–ü–∞—Ä–æ–ª—å"><button class="vault-btn" onclick="attemptLogin()">–û—Ç–∫—Ä—ã—Ç—å</button><p style="color:#666; font-size:0.8em; margin-top:15px;">AES Encryption. Zero Knowledge.<br>–¢—Ä–∏–∂–¥—ã –Ω–∞–∂–º–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤—Ö–æ–¥–∞.</p></div>
            <div id="vault-content">
                <h2 style="color:var(--soul-color); text-align:center;">üëÅÔ∏è –¢–∞–π–Ω—ã–π –ë–ª–æ–∫</h2>
                <div class="card card-shadow"><h3 style="color:var(--shadow-color)">üö´ –ê—Å–∫–µ–∑–∞ (–ë–æ—Ä—å–±–∞)</h3><div class="streak-box"><div class="streak-item"><div class="streak-val fire-icon" id="currentStreak">0</div><div class="streak-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div></div><div class="streak-item"><div class="streak-val best-icon" id="bestStreak">0</div><div class="streak-label">–†–µ–∫–æ—Ä–¥</div></div></div><p style="font-size:0.8em; color:#888">–û—Ç–º–µ—Ç—å, –µ—Å–ª–∏ –ù–ï —Å–æ—Ä–≤–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è (+XP)</p><div id="shadowList"></div><div class="secret-input-row"><input type="text" id="newShadowName" class="secret-input" placeholder="–í—Ä–µ–¥–Ω–∞—è –ø—Ä–∏–≤—ã—á–∫–∞..."><button class="secret-btn-add" onclick="addSecretTask('shadow')">+</button></div></div>
                <div class="card card-soul"><h3 style="color:var(--soul-color)">üïäÔ∏è (–†–∞–∑–≤–∏—Ç–∏–µ)</h3><div id="soulList"></div><div class="secret-input-row"><input type="text" id="newSoulName" class="secret-input" placeholder="–î—É—Ö–æ–≤–Ω–æ–µ –¥–µ–ª–æ..."><button class="secret-btn-add" onclick="addSecretTask('soul')">+</button></div></div>
                <div class="card" style="border-left-color: var(--soul-color);"><h3 style="color:var(--soul-color)">üìä –¢–∞–π–Ω–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3><div class="chart-container" style="height:200px;"><canvas id="secretChart"></canvas></div></div>
                <div class="card card-notes"><h3 style="color:var(--notes-color)">üìú –õ–∏—á–Ω—ã–µ –ú—ã—Å–ª–∏</h3><input type="text" id="newNoteTitle" class="secret-title-input" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏..."><textarea id="newSecretNote" class="secret-textarea" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..."></textarea><button class="secret-btn-save" onclick="addSecretNote()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (–®–∏—Ñ—Ä—É–µ—Ç—Å—è)</button><hr style="border:0; border-top:1px solid #333; margin:15px 0;"><div id="secretNotesList"></div></div>
                <button class="btn-block" style="margin-top:20px; background:#333; color:#888;" onclick="lockAndExit()">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏ –í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="nav"><button class="nav-btn active" onclick="switchTab('dash', this)">üè†</button><button class="nav-btn" onclick="switchTab('bogdan', this)">üë¶</button><button class="nav-btn" onclick="switchTab('stats', this)">üìä</button><button class="nav-btn" onclick="switchTab('editor', this)">üõ†</button><button class="nav-btn" onclick="switchTab('masters', this)">üë•</button></div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyAhkOgEtlG1Q2byn2PKB6iCySPqM5XocMY",
      authDomain: "slv-project-a51ff.firebaseapp.com",
      projectId: "slv-project-a51ff",
      storageBucket: "slv-project-a51ff.firebasestorage.app",
      messagingSenderId: "561475846978",
      appId: "1:561475846978:web:91f259136416b621d43edb",
      measurementId: "G-L8C9XEZLH4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    db.enablePersistence().catch(err => console.log('Persistence error:', err));

    let currentUser = null;
    let headerClicks = 0, headerTimer;
    let fizzTimerInterval = null;

    // --- SYNC INTERCEPTORS ---
    const originalSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        originalSetItem.apply(this, [key, value]);
        if (currentUser) {
            db.collection('users').doc(currentUser.uid).set({ [key]: value }, { merge: true });
        }
    };

    const originalRemoveItem = localStorage.removeItem;
    localStorage.removeItem = function(key) {
        originalRemoveItem.apply(this, [key]);
        if (currentUser) {
            db.collection('users').doc(currentUser.uid).update({
                [key]: firebase.firestore.FieldValue.delete()
            }).catch(e => {}); 
        }
    };

    // --- AUTH ---
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('currentUserEmail').innerText = user.email;
            startCloudSync();
        } else {
            document.getElementById('auth-screen').style.display = 'flex';
        }
    });

    function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(e => alert("–û—à–∏–±–∫–∞: " + e.message));
    }

    // --- CORE SYNC ---
    // --- –ó–ê–ü–£–°–ö –ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ---
    function startCloudSync() {
        db.collection('users').doc(currentUser.uid).onSnapshot((doc) => {
            const isLocalChange = doc.metadata.hasPendingWrites;
            
            if (doc.exists) {
                const data = doc.data();
                
                // –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –∏–∑ –æ–±–ª–∞–∫–∞ (–∞ –Ω–µ –º—ã —Å–∞–º–∏ –Ω–∞–∂–∞–ª–∏) - –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                if (!isLocalChange) {
                    for (const [key, value] of Object.entries(data)) {
                        originalSetItem.apply(localStorage, [key, value]);
                    }
                }
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —ç–∫—Ä–∞–Ω
                loadVariables();
                renderAll();
                
                // üî• –í–ê–ñ–ù–û: –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–æ–ª–µ—Å–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                setTimeout(drawWheel, 500); 
                
            } else {
                initDefaults();
            }
        });
        
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        if (!window.appInitialized) {
             setTimeout(drawWheel, 1000); // –†–∏—Å—É–µ–º –∫–æ–ª–µ—Å–æ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
             setInterval(checkReminders, 60000);
             window.appInitialized = true;
        }
    }

    // --- DATA & VARS ---
    const xpPerLevel = 150;
    const defaultSLV = [{id: 't1', text: '–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞', xp: 10},{id: 't2', text: '–û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞', xp: 20},{id: 't3', text: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', xp: 15},{id: 't7', text: '–ö–æ–Ω—Ç–µ–Ω—Ç', xp: 15}];
    const defaultBogdan = [{id: 'b1', text: '–°–ø–æ—Ä—Ç / –ö–∞–ø–æ—ç–π—Ä–∞', xp: 15},{id: 'b6', text: '–®–∞—Ö–º–∞—Ç—ã', xp: 10}];
    const defaultSport = [{id: 's1', text: '–û—Ç–∂–∏–º–∞–Ω–∏—è', rate: 0.5},{id: 's2', text: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è', rate: 0.2}];
    const defaultFizz = [{id: 'f1', text: '–ü—Ä—ã–∂–∫–∏', xp: 5}, {id: 'f2', text: '–†–∞—Å—Ç—è–∂–∫–∞', xp: 5}, {id: 'f3', text: '–ú–∞—Ö–∏ —Ä—É–∫–∞–º–∏', xp: 5}, {id: 'f4', text: '–ü—Ä–µ—Å—Å', xp: 5}];
    const defaultShadow = [{id: 'sh1', text: '–ù–µ —Å–∫–≤–µ—Ä–Ω–æ—Å–ª–æ–≤–∏–ª', xp: 20}, {id: 'sh2', text: '–ë–µ–∑ –≤—Ä–µ–¥–Ω–æ–π –µ–¥—ã', xp: 15}];
    const defaultSoul = [{id: 'so1', text: '–ú–æ–ª–∏—Ç–≤–∞', xp: 15}, {id: 'so2', text: '–ß—Ç–µ–Ω–∏–µ –ï–≤–∞–Ω–≥–µ–ª–∏—è', xp: 20}, {id: 'so3', text: '–î–æ–±—Ä–æ–µ –¥–µ–ª–æ', xp: 25}];
    const nutriConfig = [{id: 'prot', label: 'ü•© –ë–µ–ª–æ–∫', color: 'var(--nutri-protein)', calc: w => Math.ceil(w * 0.07)},{id: 'vege', label: 'ü•¶ –ó–µ–ª–µ–Ω—å', color: 'var(--nutri-vege)', calc: w => 5},{id: 'carb', label: 'üîã –£–≥–ª–∏', color: 'var(--nutri-carbs)', calc: w => Math.ceil(w * 0.05)},{id: 'fats', label: 'ü•ë –ñ–∏—Ä—ã', color: 'var(--nutri-fats)', calc: w => Math.ceil(w * 0.04)},{id: 'calc', label: 'ü¶¥ –ö–∞–ª—å—Ü–∏–π', color: 'var(--nutri-calcium)', calc: w => 2}];

    const imgWeak = "https://i.imgur.com/QcQoXz6.jpeg"; 
    const imgMid = "https://i.imgur.com/WKo4lyU.jpeg";  
    const imgGod = "https://i.imgur.com/XJX2go9.jpeg";  

    let totalXP = 0, userWeight = 70;
    let myTasks = [], mindTasks = [], choreTasks = [], bogdanTasks = [], sportExercises = [], fizzTasks = [], shadowTasks = [], soulTasks = [], secretNotes = [];
    let historyDate = new Date();
    let chartInstance = null, secretChartInstance = null;
    let currentFizz = null, energyValue = 5;
    let currentKey = null;

    function initDefaults() {
        myTasks = defaultSLV; bogdanTasks = defaultBogdan; sportExercises = defaultSport; fizzTasks = defaultFizz; shadowTasks = defaultShadow; soulTasks = defaultSoul;
        renderAll();
    }

    function loadVariables() {
        const savedXP = localStorage.getItem('slv_total_xp'); if(savedXP) totalXP = parseInt(savedXP);
        const savedSLV = localStorage.getItem('slv_config_tasks'); myTasks = savedSLV ? JSON.parse(savedSLV) : defaultSLV;
        const savedMind = localStorage.getItem('slv_config_mind'); mindTasks = savedMind ? JSON.parse(savedMind) : [];
        const savedChores = localStorage.getItem('slv_config_chores'); choreTasks = savedChores ? JSON.parse(savedChores) : [];
        const savedBogdan = localStorage.getItem('bogdan_config_tasks'); bogdanTasks = savedBogdan ? JSON.parse(savedBogdan) : defaultBogdan;
        const savedSport = localStorage.getItem('slv_config_sport'); sportExercises = savedSport ? JSON.parse(savedSport) : defaultSport;
        const savedFizz = localStorage.getItem('slv_config_fizz'); fizzTasks = savedFizz ? JSON.parse(savedFizz) : defaultFizz;
        const savedShadow = localStorage.getItem('slv_config_shadow'); shadowTasks = savedShadow ? JSON.parse(savedShadow) : defaultShadow;
        const savedSoul = localStorage.getItem('slv_config_soul'); soulTasks = savedSoul ? JSON.parse(savedSoul) : defaultSoul;
        const savedWeight = localStorage.getItem('slv_user_weight'); if(savedWeight) userWeight = parseInt(savedWeight); document.getElementById('userWeight').value = userWeight;
        
        const today = new Date().toLocaleDateString('ru-RU');
        const sleepData = JSON.parse(localStorage.getItem(`slv_sleep_${today}`) || 'null');
        if(sleepData) { document.getElementById('sleepStart').value = sleepData.start; document.getElementById('sleepEnd').value = sleepData.end; document.getElementById('sleepResultDisplay').innerText = sleepData.diff; }
    }
// --- UI ACCORDIONS (–í–ï–†–ù–£–¢–¨ –≠–¢–û–¢ –ë–õ–û–ö) ---
    function toggleNutri() { 
        const c = document.getElementById('nutriContent'); 
        c.classList.toggle('open'); 
        document.getElementById('nutriArrow').innerText = c.classList.contains('open') ? '‚ñ≤' : '‚ñº'; 
    }
    function toggleNutriHelp() { 
        const c = document.getElementById('nutriHelpContent'); 
        c.style.display = (c.style.display === 'block') ? 'none' : 'block'; 
        document.getElementById('nutriHelpArrow').innerText = (c.style.display === 'block') ? '‚ñ≤' : '‚ñº'; 
    }
    function toggleSport() { 
        const c = document.getElementById('sportContent'); 
        c.classList.toggle('open'); 
        document.getElementById('sportArrow').innerText = c.classList.contains('open') ? '‚ñ≤' : '‚ñº'; 
    }
    function toggleTasks() { 
        const c = document.getElementById('tasksContent'); 
        c.classList.toggle('open'); 
        document.getElementById('tasksArrow').innerText = c.classList.contains('open') ? '‚ñ≤' : '‚ñº'; 
    }

    function renderAll() {
        updateHeaderUI(); renderDashboard(); renderNutriCard(); renderSportCard(); renderAirCard();
        renderWaterCard(); renderEnergy(); renderHistory(); renderEditorList(); updateAvatarImage(); updateComparison();
    }

    // --- FX ENGINE ---
    function spawnParticles(x, y, color) {
        for (let i = 0; i < 12; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.backgroundColor = color;
            const angle = Math.random() * Math.PI * 2; const dist = 30 + Math.random() * 50;
            const tx = Math.cos(angle) * dist + 'px'; const ty = Math.sin(angle) * dist + 'px';
            p.style.setProperty('--tx', tx); p.style.setProperty('--ty', ty);
            document.body.appendChild(p); setTimeout(() => p.remove(), 800);
        }
    }
    function showFloatingXP(x, y, amount, color) {
        const el = document.createElement('div');
        el.className = 'floating-xp'; el.innerText = '+' + amount + ' XP';
        el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.color = color;
        document.body.appendChild(el); setTimeout(() => el.remove(), 1000);
    }

  // --- –ó–ê–î–ê–ß–ò –ò XP (–ò–°–ü–†–ê–í–õ–ï–ù–û) ---
    function toggleTask(taskId, xp, element, color = '#4CC9F0') { 
        const today = new Date().toLocaleDateString('ru-RU'); 
        const key = `slv_${today}_${taskId}`; 
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∞ –Ω–µ –ø–æ –≥–∞–ª–æ—á–∫–µ (–Ω–∞–¥–µ–∂–Ω–µ–µ)
        const isCurrentlyDone = localStorage.getItem(key) === 'true';

        if (!isCurrentlyDone) { 
            // –ï—Å–ª–∏ –±—ã–ª–æ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–æ -> –°—Ç–∞–≤–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
            localStorage.setItem(key, 'true'); 
            totalXP += xp;

            // FX —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (element) { 
                const rect = element.getBoundingClientRect(); 
                const x = rect.left + window.scrollX + 10; 
                const y = rect.top + window.scrollY; 
                spawnParticles(x, y, color); 
                showFloatingXP(x + 20, y - 10, xp, color); 
            }
        } else { 
            // –ï—Å–ª–∏ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ -> –°–Ω–∏–º–∞–µ–º
            localStorage.removeItem(key); 
            totalXP -= xp;
        } 
        
        if(totalXP < 0) totalXP = 0; 
        localStorage.setItem('slv_total_xp', totalXP); 
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –≥–∞–ª–æ—á–∫–∏
        setTimeout(() => renderAll(), 300); 
    }

    function renderDashboard() { 
        const dateStr = new Date().toLocaleDateString('ru-RU'); 
        document.getElementById('dailyTasks').innerHTML = myTasks.map(task => createHTML(task, dateStr, 'daily')).join(''); 
        document.getElementById('mindTasks').innerHTML = mindTasks.map(task => createHTML(task, dateStr, 'mind')).join('');
        document.getElementById('choreTasks').innerHTML = choreTasks.map(task => createOneOffHTML(task, 'chores')).join('');
        document.getElementById('bogdanTasks').innerHTML = bogdanTasks.map(task => createHTML(task, dateStr, 'bogdan')).join(''); 
    }

       
    function createHTML(task, dateStr, type) { 
        const key = `slv_${dateStr}_${task.id}`; 
        const isDone = localStorage.getItem(key) === 'true'; 
        
        let color = 'var(--primary)'; 
        if (type === 'mind') color = 'var(--soul-color)'; 
        if (type === 'bogdan') color = '#00ff9d';

        // –í–∞–∂–Ω–æ: checked —Å—Ç–∞–≤–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ isDone === true
        return `<div class="task-item ${isDone ? 'completed' : ''}">
            <input type="checkbox" ${isDone ? 'checked' : ''} onchange="toggleTask('${task.id}', ${task.xp}, this, '${color}')">
            <label>${task.text} <b style="color:${color}; float:right;">+${task.xp}</b></label>
        </div>`; 
    }

    function completeOneOff(id, type, xp, text, element) {
        if(!confirm('–í—ã–ø–æ–ª–Ω–µ–Ω–æ? –ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—Å—è –≤ –∞—Ä—Ö–∏–≤.')) { renderDashboard(); return; } 
        const color = type==='mind' ? '#E0AAFF' : '#EF476F';
        if(element) { const rect = element.getBoundingClientRect(); spawnParticles(rect.left + 10, rect.top, color); showFloatingXP(rect.left + 30, rect.top - 10, xp, color); }
        totalXP += xp; localStorage.setItem('slv_total_xp', totalXP);
        const t = new Date().toLocaleDateString('ru-RU'); const logKey = `slv_oneoff_log_${t}`;
        let log = JSON.parse(localStorage.getItem(logKey) || '[]'); log.push({ text: text, xp: xp, type: type }); localStorage.setItem(logKey, JSON.stringify(log));
        if (type === 'chores') { choreTasks = choreTasks.filter(t => t.id !== id); localStorage.setItem('slv_config_chores', JSON.stringify(choreTasks)); }
        setTimeout(() => renderAll(), 500);
    }

    function updateHeaderUI() { const level = Math.floor(totalXP / xpPerLevel) + 1; const progress = (totalXP % xpPerLevel) / xpPerLevel * 100; document.getElementById('userLevel').innerText = `–£—Ä–æ–≤–µ–Ω—å ${level}`; document.getElementById('xpText').innerText = `${Math.floor(totalXP)} XP`; document.getElementById('xpBar').style.width = `${progress}%`; }
    function switchTaskTab(tabName, btn) { document.querySelectorAll('.task-list-container').forEach(el => el.classList.remove('active')); document.querySelectorAll('.task-tab-btn').forEach(el => el.classList.remove('active')); document.getElementById(`tab-${tabName}`).classList.add('active'); btn.classList.add('active'); }
    
    function updateAvatarImage() {
        const today = new Date().toLocaleDateString('ru-RU');
        let rawScore = 0; 
        const sleepData = JSON.parse(localStorage.getItem(`slv_sleep_${today}`) || 'null');
        let sleepHours = 0; if (sleepData) sleepHours = parseInt(sleepData.diff);
        if (sleepHours >= 7.5) rawScore += 30; else if (sleepHours >= 6) rawScore += 20; else if (sleepHours >= 4) rawScore += 10;
        const water = parseInt(localStorage.getItem(`slv_water_${today}`) || '0');
        const waterGoal = userWeight * 30; const waterPct = waterGoal > 0 ? Math.min(1, water/waterGoal) : 0;
        rawScore += waterPct * 25;
        let nutriCount = 0; let activeCategories = 0; 
        nutriConfig.forEach(cat => { const val = parseFloat(localStorage.getItem(`slv_nutri_${today}_${cat.id}`) || '0'); if (val >= 0.5) activeCategories++; if (val >= 1) nutriCount++; });
        let nutriScore = (nutriCount / 5) * 15;
        let varietyMultiplier = activeCategories === 0 ? 0 : (activeCategories === 1 ? 0.3 : (activeCategories === 2 ? 0.6 : 1.0));
        rawScore += (nutriScore * varietyMultiplier);
        let sportCount = 0; sportExercises.forEach(ex => { if(parseInt(localStorage.getItem(`slv_sport_${today}_${ex.id}`) || '0') > 0) sportCount++; });
        if (sportCount > 0) rawScore += 15;
        const air = parseInt(localStorage.getItem(`slv_air_${today}`) || '0'); const airPct = Math.min(1, air/60); rawScore += airPct * 15;
        let multiplier = 1.0;
        if (sleepHours < 4) multiplier *= 0.4; else if (sleepHours < 6) multiplier *= 0.8;
        if (waterPct < 0.3) multiplier *= 0.6;
        if (sportCount === 0 && air === 0) multiplier *= 0.7;
        let finalPct = Math.floor(rawScore * multiplier); if (finalPct > 100) finalPct = 100;
        const img = document.getElementById('avatarImage'); const balanceBar = document.getElementById('hudBalanceBar');
        const balanceText = document.getElementById('hudBalanceText'); const systemStatus = document.getElementById('hudSystemStatus');
        const hudWater = document.getElementById('hudWaterVal'); const hudSleep = document.getElementById('hudSleepVal');
        const hudAir = document.getElementById('hudAirVal'); const hudNutri = document.getElementById('hudNutriVal'); const hudSport = document.getElementById('hudSportVal');
        if(hudWater) hudWater.innerText = Math.floor(waterPct*100) + '%';
        if(hudSleep) hudSleep.innerText = sleepHours > 0 ? sleepHours + '—á' : '--';
        if(hudAir) hudAir.innerText = air + '–º';
        if(hudNutri) hudNutri.innerText = Math.floor((nutriScore * varietyMultiplier / 15) * 100) + '%';
        if(hudSport) hudSport.innerText = sportCount;
        if (img && balanceBar) {
            balanceBar.style.height = `${finalPct}%`; balanceText.innerText = `${finalPct}%`;
            let visualState = 'weak'; 
            if (finalPct < 40) visualState = 'weak'; else if (finalPct < 75) visualState = 'mid'; else if (sportCount > 0) visualState = 'god'; else visualState = 'mid';
            if (visualState === 'weak') { balanceBar.style.background = "var(--danger)"; img.src = imgWeak; if(systemStatus) { systemStatus.innerText = "–ò–°–¢–û–©–ï–ù–ò–ï"; systemStatus.style.color = "var(--danger)"; } } 
            else if (visualState === 'mid') { balanceBar.style.background = "var(--warning)"; img.src = imgMid; if(systemStatus) { if (finalPct >= 75 && sportCount === 0) { systemStatus.innerText = "–ù–£–ñ–ï–ù –°–ü–û–†–¢"; systemStatus.style.color = "#FFB703"; } else { systemStatus.innerText = "–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨"; systemStatus.style.color = "var(--warning)"; } } } 
            else if (visualState === 'god') { balanceBar.style.background = "var(--success)"; img.src = imgGod; if(systemStatus) { systemStatus.innerText = "–ü–ò–ö–û–í–ê–Ø –§–û–†–ú–ê"; systemStatus.style.color = "var(--success)"; } }
        }
    }

    function headerClick() { headerClicks++; clearTimeout(headerTimer); if (headerClicks === 3) { openSecret(); headerClicks = 0; } else { headerTimer = setTimeout(() => headerClicks = 0, 500); } }
    function saveWeight(val) { if(val) { userWeight = parseInt(val); localStorage.setItem('slv_user_weight', userWeight); renderAll(); } }
    
    // --- FIXED HYDRATION & AIR ---
   

    // --- üíß –í–û–î–ê (–ò–°–ü–†–ê–í–õ–ï–ù–û) ---
    function renderWaterCard() { 
        const t = new Date().toLocaleDateString('ru-RU'); 
        // –í index.html –±—ã–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã –æ–±—Ä–∞—Ç–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
        const c = parseInt(localStorage.getItem(`slv_water_${t}`) || '0'); 
        const g = userWeight * 30; 
        document.getElementById('waterGoalDisplay').innerText = `–¶–µ–ª—å: ${g} –º–ª`; 
        document.getElementById('waterCurrent').innerText = c; 
        document.getElementById('waterBar').style.width = `${Math.min(100, (c/g)*100)}%`; 
    }

    function addWater(a) { 
        const t = new Date().toLocaleDateString('ru-RU'); 
        const k = `slv_water_${t}`; 
        let c = parseInt(localStorage.getItem(k) || '0'); 
        if (c + a < 0) return; 
        c += a; 
        localStorage.setItem(k, c); 
        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∫–∞–∫ –≤ slv.html
        totalXP += (a/100); 
        if(totalXP < 0) totalXP = 0; 
        localStorage.setItem('slv_total_xp', totalXP); 
        renderAll(); 
    }

    // --- üå¨Ô∏è –í–û–ó–î–£–• (–ò–°–ü–†–ê–í–õ–ï–ù–û) ---
    function renderAirCard() { 
        const t = new Date().toLocaleDateString('ru-RU'); 
        const c = parseInt(localStorage.getItem(`slv_air_${t}`) || '0'); 
        const g = 60; 
        document.getElementById('airGoalDisplay').innerText = `–¶–µ–ª—å: ${g} –º–∏–Ω`; 
        document.getElementById('airCurrent').innerText = c; 
        document.getElementById('airBar').style.width = `${Math.min(100, (c/g)*100)}%`; 
    }

    function addAir(a) { 
        const t = new Date().toLocaleDateString('ru-RU'); 
        const k = `slv_air_${t}`; 
        let c = parseInt(localStorage.getItem(k) || '0'); 
        if (c + a < 0) return; 
        c += a; 
        localStorage.setItem(k, c); 
        const xpToAdd = (a/15) * 5; 
        totalXP += xpToAdd; 
        if(totalXP < 0) totalXP = 0; 
        localStorage.setItem('slv_total_xp', totalXP); 
        renderAll(); 
    }

    function saveSleep() {
        const start = document.getElementById('sleepStart').value;
        const end = document.getElementById('sleepEnd').value;
        if (!start || !end) { alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è"); return; }
        
        const startDate = new Date(`2000-01-01T${start}`); 
        let endDate = new Date(`2000-01-01T${end}`); 
        if (endDate < startDate) endDate.setDate(endDate.getDate() + 1);
        
        const diffMs = endDate - startDate; 
        const hours = Math.floor(diffMs / 3600000); 
        const minutes = Math.floor((diffMs % 3600000) / 60000); 
        const diffText = `${hours} —á ${minutes} –º–∏–Ω`;
        
        document.getElementById('sleepResultDisplay').innerText = diffText;
        const today = new Date().toLocaleDateString('ru-RU'); 
        const key = `slv_sleep_${today}`;
        
        if (!localStorage.getItem(key)) { 
            totalXP += 10; 
            localStorage.setItem('slv_total_xp', totalXP); 
            updateHeaderUI(); 
        }
        localStorage.setItem(key, JSON.stringify({start: start, end: end, diff: diffText})); 
        alert(`–°–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${diffText}`); 
        renderAll(); 
    }
    function getEnergyText(val) { if(val<=2) return "üßü –ó–æ–º–±–∏"; if(val<=4) return "üê¢ –í—è–ª–æ—Å—Ç—å"; if(val<=6) return "üòê –ù–æ—Ä–º–∞"; if(val<=8) return "üí™ –ë–æ–¥—Ä–æ—Å—Ç—å"; return "üöÄ –†–∞–∫–µ—Ç–∞"; }
    function updateEnergyUI(val) { energyValue = val; document.getElementById('energyVal').innerText = val; document.getElementById('energyText').innerText = getEnergyText(val); }
    function logEnergy() { const t = new Date().toLocaleDateString('ru-RU'); const k = `slv_energy_log_${t}`; let l = JSON.parse(localStorage.getItem(k) || '[]'); l.push({time: new Date().toTimeString().substring(0,5), val: energyValue}); localStorage.setItem(k, JSON.stringify(l)); renderEnergy(); renderAll(); }
    function renderEnergy() { const t = new Date().toLocaleDateString('ru-RU'); const l = JSON.parse(localStorage.getItem(`slv_energy_log_${t}`) || '[]'); if(l.length>0) { document.querySelector('input[type=range]').value = l[l.length-1].val; updateEnergyUI(l[l.length-1].val); } document.getElementById('energyLog').innerHTML = l.map(e => `<div class="energy-log-item"><span>${e.time}</span><span style="color:var(--warning)">${getEnergyText(e.val)}</span></div>`).join(''); }
    function renderSportCard() { const t = new Date().toLocaleDateString('ru-RU'); document.getElementById('sportList').innerHTML = sportExercises.map(ex => { const c = parseInt(localStorage.getItem(`slv_sport_${t}_${ex.id}`) || '0'); return `<div class="sport-item"><label style="flex:1">${ex.text}</label><div class="sport-controls"><button class="sport-btn" onclick="changeSport('${ex.id}', -10)">-</button><input type="number" class="sport-input" value="${c}" onchange="setSportExact('${ex.id}', this.value)"><button class="sport-btn" onclick="changeSport('${ex.id}', 10)">+</button></div></div>`; }).join(''); }
    function changeSport(id, d) { const t=new Date().toLocaleDateString('ru-RU'); let c=parseInt(localStorage.getItem(`slv_sport_${t}_${id}`)||0)+d; setSportExact(id, c<0?0:c); }
    function setSportExact(id, v) { const t=new Date().toLocaleDateString('ru-RU'); const old=parseInt(localStorage.getItem(`slv_sport_${t}_${id}`)||0); const val=parseInt(v); if(isNaN(val))return; const rate=sportExercises.find(e=>e.id===id).rate; localStorage.setItem(`slv_sport_${t}_${id}`, val); totalXP+=(val-old)*rate; if(totalXP<0)totalXP=0; localStorage.setItem('slv_total_xp', totalXP); renderAll(); }
    
  // --- üé° –ö–û–õ–ï–°–û (–ò–°–ü–†–ê–í–õ–ï–ù–û) ---
    function drawWheel() { 
        const canvas = document.getElementById('fizzWheel'); 
        if (!canvas) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞ –∏–ª–∏ DOM –Ω–µ –≥–æ—Ç–æ–≤
        
        const ctx = canvas.getContext('2d'); 
        const width = canvas.width; 
        const height = canvas.height; 
        const centerX = width / 2; 
        const centerY = height / 2; 
        const radius = width / 2 - 5; 
        
        ctx.clearRect(0, 0, width, height); 
        
        // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, —Ä–∏—Å—É–µ–º –∑–∞–≥–ª—É—à–∫—É
        if (!fizzTasks || fizzTasks.length === 0) { 
            ctx.fillStyle = '#333'; 
            ctx.beginPath(); 
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI); 
            ctx.fill(); 
            // –ü–∏—à–µ–º —Ç–µ–∫—Å—Ç, —á—Ç–æ –ø—É—Å—Ç–æ
            ctx.fillStyle = '#666';
            ctx.font = "14px Segoe UI";
            ctx.textAlign = "center";
            ctx.fillText("–ó–∞–≥—Ä—É–∑–∫–∞...", centerX, centerY);
            return; 
        } 
        
        const step = (2 * Math.PI) / fizzTasks.length; 
        const colors = ['#FFB703', '#FB8500', '#FFD166', '#E09F3E']; 
        
        for (let i = 0; i < fizzTasks.length; i++) { 
            const startAngle = i * step; 
            const endAngle = startAngle + step; 
            ctx.beginPath(); 
            ctx.moveTo(centerX, centerY); 
            ctx.arc(centerX, centerY, radius, startAngle, endAngle); 
            ctx.closePath(); 
            ctx.fillStyle = colors[i % colors.length]; 
            ctx.fill(); 
            ctx.lineWidth = 2; 
            ctx.strokeStyle = '#111'; 
            ctx.stroke(); 
            
            ctx.save(); 
            ctx.translate(centerX, centerY); 
            ctx.rotate(startAngle + step / 2); 
            ctx.textAlign = "right"; 
            ctx.fillStyle = "#000"; 
            ctx.font = "bold 14px Segoe UI"; 
            ctx.fillText(fizzTasks[i].text.substring(0, 12) + (fizzTasks[i].text.length > 12 ? "..." : ""), radius - 10, 5); 
            ctx.restore(); 
        } 
    }
    function startFizzTimer() { const display = document.getElementById('fizzTimerDisplay'); const startBtn = document.getElementById('btnStartTimer'); const doneBtn = document.getElementById('btnFizzDone'); startBtn.style.display = 'none'; display.style.display = 'block'; let timeLeft = 5 * 60; function tick() { const m = Math.floor(timeLeft / 60).toString().padStart(2, '0'); const s = (timeLeft % 60).toString().padStart(2, '0'); display.innerText = `${m}:${s}`; if (timeLeft <= 0) { clearInterval(fizzTimerInterval); display.innerText = "00:00"; display.style.color = "var(--success)"; doneBtn.disabled = false; doneBtn.style.opacity = '1'; doneBtn.style.cursor = 'pointer'; if (navigator.vibrate) navigator.vibrate([200, 100, 200]); } timeLeft--; } tick(); fizzTimerInterval = setInterval(tick, 1000); }
    function spinWheel() { if (fizzTasks.length === 0) { alert("–î–æ–±–∞–≤—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ!"); return; } const wheel = document.getElementById('fizzWheel'); const btn = document.querySelector('.fizz-btn'); btn.disabled = true; const randIndex = Math.floor(Math.random() * fizzTasks.length); currentFizz = fizzTasks[randIndex]; const sliceDeg = 360 / fizzTasks.length; const targetSliceAngle = 270 - (randIndex * sliceDeg) - (sliceDeg / 2); const finalRotation = (5 * 360) + targetSliceAngle; wheel.style.transition = "transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)"; wheel.style.transform = `rotate(${finalRotation}deg)`; setTimeout(() => { document.getElementById('fizzName').innerText = currentFizz.text; document.getElementById('fizzXP').innerText = `+${currentFizz.xp} XP`; document.getElementById('fizzResult').style.display = 'block'; const display = document.getElementById('fizzTimerDisplay'); display.style.display = 'none'; display.style.color = 'var(--fizz-color)'; display.innerText = '05:00'; document.getElementById('btnStartTimer').style.display = 'block'; const doneBtn = document.getElementById('btnFizzDone'); doneBtn.disabled = true; doneBtn.style.opacity = '0.5'; doneBtn.style.cursor = 'not-allowed'; btn.disabled = false; }, 4000); }
    function completeFizz() { if(!currentFizz) return; clearInterval(fizzTimerInterval); const btn = document.getElementById('btnFizzDone'); const rect = btn.getBoundingClientRect(); spawnParticles(rect.left + 50, rect.top, 'var(--fizz-color)'); showFloatingXP(rect.left + 50, rect.top - 20, currentFizz.xp, 'var(--fizz-color)'); const t=new Date().toLocaleDateString('ru-RU'); localStorage.setItem(`slv_fizz_${t}_${Date.now()}`, JSON.stringify({text:currentFizz.text, xp:currentFizz.xp})); totalXP+=currentFizz.xp; localStorage.setItem('slv_total_xp', totalXP); setTimeout(() => { document.getElementById('fizzResult').style.display='none'; renderAll(); const wheel = document.getElementById('fizzWheel'); wheel.style.transition = 'none'; wheel.style.transform = 'rotate(0deg)'; }, 500); }

    function addNewTask(){ const n=document.getElementById('newTaskName').value; const x=parseInt(document.getElementById('newTaskXP').value); const t=document.getElementById('targetList').value; if(!n)return; const o={id:'t_'+Date.now(), text:n, xp:x}; if(t==='daily'){ myTasks.push(o); localStorage.setItem('slv_config_tasks',JSON.stringify(myTasks)); } else if(t==='mind') { mindTasks.push(o); localStorage.setItem('slv_config_mind',JSON.stringify(mindTasks)); } else if(t==='chores') { choreTasks.push(o); localStorage.setItem('slv_config_chores',JSON.stringify(choreTasks)); } else if(t==='bogdan') { bogdanTasks.push(o); localStorage.setItem('bogdan_config_tasks',JSON.stringify(bogdanTasks)); } document.getElementById('newTaskName').value = ''; renderAll(); }
    function addNewSport() { const n=document.getElementById('newSportName').value, r=parseFloat(document.getElementById('newSportRate').value); if(!n)return; sportExercises.push({id:'sp_'+Date.now(),text:n,rate:r}); localStorage.setItem('slv_config_sport',JSON.stringify(sportExercises)); renderAll(); }
    function addNewFizz() { const n=document.getElementById('newFizzName').value, x=parseInt(document.getElementById('newFizzXP').value); if(!n)return; fizzTasks.push({id:'fz_'+Date.now(),text:n,xp:x}); localStorage.setItem('slv_config_fizz',JSON.stringify(fizzTasks)); renderAll(); }
    function deleteTask(id, type) { if(!confirm('–£–¥–∞–ª–∏—Ç—å?'))return; if(type==='slv') {myTasks=myTasks.filter(t=>t.id!==id);localStorage.setItem('slv_config_tasks',JSON.stringify(myTasks));} else if(type==='mind') {mindTasks=mindTasks.filter(t=>t.id!==id);localStorage.setItem('slv_config_mind',JSON.stringify(mindTasks));} else if(type==='chores') {choreTasks=choreTasks.filter(t=>t.id!==id);localStorage.setItem('slv_config_chores',JSON.stringify(choreTasks));} else if(type==='bogdan') {bogdanTasks=bogdanTasks.filter(t=>t.id!==id);localStorage.setItem('bogdan_config_tasks',JSON.stringify(bogdanTasks));} else if(type==='sport') {sportExercises=sportExercises.filter(t=>t.id!==id);localStorage.setItem('slv_config_sport',JSON.stringify(sportExercises));} else if(type==='fizz') {fizzTasks=fizzTasks.filter(t=>t.id!==id);localStorage.setItem('slv_config_fizz',JSON.stringify(fizzTasks));} renderAll(); }
    function editTask(id, type) { let list; if (type==='slv') list=myTasks; else if (type==='bogdan') list=bogdanTasks; else if (type==='sport') list=sportExercises; else if (type==='fizz') list=fizzTasks; const item = list.find(t => t.id === id); if (!item) return; const newName = prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:", item.text); if (newName === null) return; let newVal = prompt("–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:", type === 'sport' ? item.rate : item.xp); if (newVal === null) return; newVal = parseFloat(newVal); if (isNaN(newVal)) return; item.text = newName; if (type === 'sport') item.rate = newVal; else item.xp = newVal; if (type==='slv') localStorage.setItem('slv_config_tasks',JSON.stringify(myTasks)); else if (type==='bogdan') localStorage.setItem('bogdan_config_tasks',JSON.stringify(bogdanTasks)); else if (type==='sport') localStorage.setItem('slv_config_sport',JSON.stringify(sportExercises)); else if (type==='fizz') localStorage.setItem('slv_config_fizz',JSON.stringify(fizzTasks)); renderAll(); }
    function renderEditorList() { const btn=(id,t)=>`<div class="edit-controls"><button class="btn-icon btn-edit" onclick="editTask('${id}','${t}')">‚úèÔ∏è</button><button class="btn-icon btn-delete" onclick="deleteTask('${id}','${t}')">‚úñ</button></div>`; document.getElementById('editListSLV').innerHTML=myTasks.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.xp} XP)</span>${btn(t.id,'slv')}</div>`).join(''); document.getElementById('editListBogdan').innerHTML=bogdanTasks.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.xp} XP)</span>${btn(t.id,'bogdan')}</div>`).join(''); document.getElementById('editListSport').innerHTML=sportExercises.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.rate}/—Ä–∞–∑)</span>${btn(t.id,'sport')}</div>`).join(''); document.getElementById('editListFizz').innerHTML=fizzTasks.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.xp} XP)</span>${btn(t.id,'fizz')}</div>`).join(''); document.getElementById('editListMind').innerHTML=mindTasks.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.xp} XP)</span>${btn(t.id,'mind')}</div>`).join(''); document.getElementById('editListChores').innerHTML=choreTasks.map(t=>`<div class="edit-list-item"><span>${t.text} (${t.xp} XP)</span>${btn(t.id,'chores')}</div>`).join(''); }

    function openSecret() { document.querySelectorAll('.screen').forEach(el => el.classList.remove('active')); document.getElementById('screen-secret').classList.add('active'); document.getElementById('vault-door').style.display = 'block'; document.getElementById('vault-content').style.display = 'none'; document.getElementById('vaultPass').value = ''; }
    function attemptLogin() { const pass = document.getElementById('vaultPass').value; if(!pass) return; try { const encryptedNotes = localStorage.getItem('slv_secret_notes_enc'); if (!encryptedNotes) { currentKey = pass; secretNotes = []; unlockVaultUI(); } else { const bytes = CryptoJS.AES.decrypt(encryptedNotes, pass); const decryptedData = bytes.toString(CryptoJS.enc.Utf8); if (decryptedData) { secretNotes = JSON.parse(decryptedData); currentKey = pass; unlockVaultUI(); } else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!"); } } } catch (e) { alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞!"); } }
    function unlockVaultUI() { document.getElementById('vault-door').style.display = 'none'; document.getElementById('vault-content').style.display = 'block'; renderSecretScreen(); }
    function lockAndExit() { currentKey = null; secretNotes = []; switchTab('dash', document.querySelector('.nav-btn')); }
    function saveEncryptedNotes() { if (!currentKey) return; const ciphertext = CryptoJS.AES.encrypt(JSON.stringify(secretNotes), currentKey).toString(); localStorage.setItem('slv_secret_notes_enc', ciphertext); }
    function addSecretNote() { const title = document.getElementById('newNoteTitle').value || "–ë–µ–∑ —Ç–µ–º—ã"; const text = document.getElementById('newSecretNote').value; if(!text) return; const note = { id: 'note_' + Date.now(), title: title, text: text, date: new Date().toLocaleString('ru-RU') }; secretNotes.unshift(note); saveEncryptedNotes(); document.getElementById('newSecretNote').value = ''; document.getElementById('newNoteTitle').value = ''; renderSecretScreen(); }
    function deleteSecretNote(id) { if(!confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É?")) return; secretNotes = secretNotes.filter(n => n.id !== id); saveEncryptedNotes(); renderSecretScreen(); }
    function toggleNoteBody(id) { const body = document.getElementById(`note_body_${id}`); const arrow = document.getElementById(`note_arrow_${id}`); if (body.style.display === 'none' || body.style.display === '') { body.style.display = 'block'; arrow.innerText = '‚ñ≤'; } else { body.style.display = 'none'; arrow.innerText = '‚ñº'; } }
    function addSecretTask(type) { const nameId = type === 'shadow' ? 'newShadowName' : 'newSoulName'; const name = document.getElementById(nameId).value; if(!name) return; const newItem = { id: type + '_' + Date.now(), text: name, xp: 20 }; if (type === 'shadow') { shadowTasks.push(newItem); localStorage.setItem('slv_config_shadow', JSON.stringify(shadowTasks)); } else { soulTasks.push(newItem); localStorage.setItem('slv_config_soul', JSON.stringify(soulTasks)); } document.getElementById(nameId).value = ''; renderSecretScreen(); }
    function deleteSecretTask(id, type) { if(!confirm("–£–¥–∞–ª–∏—Ç—å?")) return; if (type === 'shadow') { shadowTasks = shadowTasks.filter(t => t.id !== id); localStorage.setItem('slv_config_shadow', JSON.stringify(shadowTasks)); } else { soulTasks = soulTasks.filter(t => t.id !== id); localStorage.setItem('slv_config_soul', JSON.stringify(soulTasks)); } renderSecretScreen(); }
    function toggleSecretTask(id, xp) { const today = new Date().toLocaleDateString('ru-RU'); const key = `slv_secret_${today}_${id}`; if (localStorage.getItem(key) === 'true') { localStorage.removeItem(key); totalXP -= xp; } else { localStorage.setItem(key, 'true'); totalXP += xp; } if(totalXP < 0) totalXP = 0; localStorage.setItem('slv_total_xp', totalXP); updateHeaderUI(); renderSecretScreen(); }
    function calculateStreaks() { const successDates = new Set(); for(let i=0; i<localStorage.length; i++) { const key = localStorage.key(i); if(key.startsWith('slv_secret_') && shadowTasks.some(t => key.endsWith(t.id)) && localStorage.getItem(key) === 'true') { const parts = key.split('_'); if(parts.length >= 4) successDates.add(parts[2]); } } const sortedDates = Array.from(successDates).map(d => { const [dd,mm,yyyy] = d.split('.'); return new Date(`${yyyy}-${mm}-${dd}`).getTime(); }).sort((a,b) => a - b); if(sortedDates.length === 0) return { current: 0, best: 0 }; let currentStreak = 0, bestStreak = 0, tempStreak = 1; for (let i = 1; i < sortedDates.length; i++) { const diff = (sortedDates[i] - sortedDates[i-1]) / 86400000; if (Math.round(diff) === 1) tempStreak++; else { if(tempStreak > bestStreak) bestStreak = tempStreak; tempStreak = 1; } } if(tempStreak > bestStreak) bestStreak = tempStreak; const today = new Date(); today.setHours(0,0,0,0); const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1); yesterday.setHours(0,0,0,0); const hasToday = sortedDates.includes(today.getTime()); const hasYesterday = sortedDates.includes(yesterday.getTime()); if (!hasToday && !hasYesterday) currentStreak = 0; else { let checkTime = hasToday ? today.getTime() : yesterday.getTime(); currentStreak = 0; while (sortedDates.includes(checkTime)) { currentStreak++; checkTime -= 86400000; } } return { current: currentStreak, best: bestStreak }; }
    function renderSecretScreen() { document.getElementById('shadowList').innerHTML = shadowTasks.map(t => { const key = `slv_secret_${new Date().toLocaleDateString('ru-RU')}_${t.id}`; const isDone = localStorage.getItem(key) === 'true'; return `<div style="display:flex;align-items:center;justify-content:space-between;background:#222;padding:10px;margin-bottom:5px;border-radius:5px;"><div style="display:flex;align-items:center;"><input type="checkbox" ${isDone ? 'checked' : ''} onchange="toggleSecretTask('${t.id}', ${t.xp})" style="width:20px;height:20px;margin-right:10px;accent-color:var(--shadow-color);"><span style="color:${isDone ? '#666' : 'white'};text-decoration:${isDone ? 'line-through' : 'none'}">${t.text}</span></div><button onclick="deleteSecretTask('${t.id}', 'shadow')" style="background:none;border:none;color:#666;cursor:pointer;">‚úñ</button></div>`; }).join(''); document.getElementById('soulList').innerHTML = soulTasks.map(t => { const key = `slv_secret_${new Date().toLocaleDateString('ru-RU')}_${t.id}`; const isDone = localStorage.getItem(key) === 'true'; return `<div style="display:flex;align-items:center;justify-content:space-between;background:#222;padding:10px;margin-bottom:5px;border-radius:5px;"><div style="display:flex;align-items:center;"><input type="checkbox" ${isDone ? 'checked' : ''} onchange="toggleSecretTask('${t.id}', ${t.xp})" style="width:20px;height:20px;margin-right:10px;accent-color:var(--soul-color);"><span style="color:${isDone ? '#666' : 'white'};text-decoration:${isDone ? 'line-through' : 'none'}">${t.text}</span></div><button onclick="deleteSecretTask('${t.id}', 'soul')" style="background:none;border:none;color:#666;cursor:pointer;">‚úñ</button></div>`; }).join(''); document.getElementById('secretNotesList').innerHTML = secretNotes.map(n => `<div class="note-item"><div class="note-header" onclick="toggleNoteBody('${n.id}')"><div><span id="note_arrow_${n.id}" class="note-arrow">‚ñº</span><span class="note-title-text">${n.title || "–ó–∞–º–µ—Ç–∫–∞"}</span><span class="note-date">${n.date}</span></div><button class="note-delete" onclick="event.stopPropagation(); deleteSecretNote('${n.id}')">‚úñ</button></div><div id="note_body_${n.id}" class="note-body">${n.text}</div></div>`).join(''); const streaks = calculateStreaks(); document.getElementById('currentStreak').innerText = streaks.current; document.getElementById('bestStreak').innerText = streaks.best; setTimeout(renderSecretChart, 100); }
    function renderSecretChart() { const ctx = document.getElementById('secretChart'); if(!ctx) return; const labels = [], soulData = [], shadowData = []; for(let i=6; i>=0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const dateStr = d.toLocaleDateString('ru-RU'); labels.push(dateStr.slice(0,5)); let sVal = 0, shVal = 0; soulTasks.forEach(t => { if(localStorage.getItem(`slv_secret_${dateStr}_${t.id}`)==='true') sVal+=t.xp; }); shadowTasks.forEach(t => { if(localStorage.getItem(`slv_secret_${dateStr}_${t.id}`)==='true') shVal+=t.xp; }); soulData.push(sVal); shadowData.push(shVal); } if (secretChartInstance) secretChartInstance.destroy(); secretChartInstance = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [ { label: '–î—É—à–∞', data: soulData, backgroundColor: '#E0AAFF' }, { label: '–ê—Å–∫–µ–∑–∞', data: shadowData, backgroundColor: '#6C757D' } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#333' } }, x: { grid: { display: false } } } } }); }

    function importData(i) { const f = i.files[0]; if(!f) return; const r = new FileReader(); r.onload = function(e) { try { const d = JSON.parse(e.target.result); for(let k in d) localStorage.setItem(k, d[k]); alert('–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ!'); location.reload(); } catch(e) { alert('–û—à–∏–±–∫–∞ —Ñ–∞–π–ª–∞'); } }; r.readAsText(f); }
    
    function renderHistory() { const dateStr = historyDate.toLocaleDateString('ru-RU'); const yyyy = historyDate.getFullYear(); const mm = String(historyDate.getMonth() + 1).padStart(2, '0'); const dd = String(historyDate.getDate()).padStart(2, '0'); const dInput = document.getElementById('historyDateInput'); if(dInput) dInput.value = `${yyyy}-${mm}-${dd}`; let dayXP = 0; let slvH = '', bogdanH = '', sportH = '', fizzH = '', waterH = '', energyH = '', sleepH = '', airH = '';
        const oneOffLog = JSON.parse(localStorage.getItem(`slv_oneoff_log_${dateStr}`) || '[]');
        oneOffLog.forEach(item => { dayXP += item.xp; const icon = item.type === 'mind' ? 'üëÅÔ∏è' : 'üßπ'; const color = item.type === 'mind' ? 'var(--soul-color)' : 'var(--danger)'; slvH += `<div class="task-item completed" style="padding:8px; margin-bottom:6px;"><span style="color:${color};">${icon}</span> <label style="margin-left:10px;">${item.text}</label> <span style="color:var(--primary);">+${item.xp}</span></div>`; });
        const sleepData = JSON.parse(localStorage.getItem(`slv_sleep_${dateStr}`) || 'null'); if(sleepData) { sleepH = `<div class="task-item completed" style="padding:8px;margin-bottom:6px;"><span style="color:var(--sleep-color);">üí§</span> <label style="margin-left:10px;">–°–æ–Ω: ${sleepData.diff}</label></div>`; }
        const airVal = parseInt(localStorage.getItem(`slv_air_${dateStr}`) || '0'); if(airVal>0) { const earned = (airVal/15)*5; dayXP += earned; airH = `<div class="task-item completed" style="padding:8px;margin-bottom:6px;"><span style="color:var(--air-color);">üå¨Ô∏è</span> <label style="margin-left:10px;">–í–æ–∑–¥—É—Ö: ${airVal} –º–∏–Ω</label> <span style="color:var(--primary);">+${Math.floor(earned)}</span></div>`; }
        myTasks.forEach(t => { if(localStorage.getItem(`slv_${dateStr}_${t.id}`) === 'true') { dayXP += t.xp; slvH += histItem(t.text, t.xp); }});
        bogdanTasks.forEach(t => { if(localStorage.getItem(`slv_${dateStr}_${t.id}`) === 'true') { dayXP += t.xp; bogdanH += histItem(t.text, t.xp); }});
        sportExercises.forEach(s => { const count = parseInt(localStorage.getItem(`slv_sport_${dateStr}_${s.id}`) || '0'); if(count > 0) { const earned = count * s.rate; dayXP += earned; sportH += `<div class="task-item completed" style="padding:8px; margin-bottom:6px;"><span style="color:var(--sport-color);">üí™</span> <label style="margin-left:10px;">${s.text}: ${count}</label> <span style="color:var(--primary);">+${Math.floor(earned)}</span></div>`; } });
        for(let i=0; i<localStorage.length; i++) { const key = localStorage.key(i); if(key.startsWith(`slv_fizz_${dateStr}_`)) { const data = JSON.parse(localStorage.getItem(key)); dayXP += data.xp; fizzH += `<div class="task-item completed" style="padding:8px; margin-bottom:6px;"><span style="color:var(--fizz-color);">‚ö°</span> <label style="margin-left:10px;">${data.text}</label> <span style="color:var(--primary);">+${data.xp}</span></div>`; } }
        let nutriH = ''; nutriConfig.forEach(cat => { const val = parseFloat(localStorage.getItem(`slv_nutri_${dateStr}_${cat.id}`) || '0'); if(val > 0) { const earned = val * 2; dayXP += earned; nutriH += `<div style="color:#aaa; margin-left:10px; font-size:0.9em;">${cat.label}: ${val} –ø–æ—Ä—Ü. (+${earned} XP)</div>`; } }); if(nutriH) nutriH = `<div class="history-section-title" style="color:#06D6A0">üß¨ –ü–∏—Ç–∞–Ω–∏–µ</div>${nutriH}`;
        const w = parseInt(localStorage.getItem(`slv_water_${dateStr}`)||0); if(w>0) { const goal = userWeight * 30; const wXP = w / 100; dayXP += wXP; waterH = `<div class="task-item completed" style="padding:8px; margin-bottom:6px;"><span style="color:var(--water-color);">üíß</span> <label style="margin-left:10px;">–í—ã–ø–∏—Ç–æ: ${w} / ${goal} –º–ª</label> <span style="color:var(--primary);">+${Math.floor(wXP)}</span></div>`; }
        const eLog = JSON.parse(localStorage.getItem(`slv_energy_log_${dateStr}`) || '[]'); if(eLog.length > 0) { energyH = eLog.map(e => `<div style="color:#888; font-size:0.9em; margin-left:10px;">${e.time} ‚Äî ${getEnergyText(e.val)} (${e.val})</div>`).join(''); }
        let html = ''; if(sleepH) html += `<div class="history-section-title" style="color:var(--sleep-color)">üí§ –°–æ–Ω</div>${sleepH}`; if(nutriH) html += nutriH; if(airH) html += `<div class="history-section-title" style="color:var(--air-color)">üå¨Ô∏è –í–æ–∑–¥—É—Ö</div>${airH}`; if(energyH) html += `<div class="history-section-title" style="color:var(--warning)">üîã –≠–Ω–µ—Ä–≥–∏—è</div>${energyH}`; if(waterH) html += `<div class="history-section-title" style="color:var(--water-color)">üíß –í–æ–¥–∞</div>${waterH}`; if(fizzH) html += `<div class="history-section-title" style="color:var(--fizz-color)">‚ö° –†–∞–∑–º–∏–Ω–∫–∏</div>${fizzH}`; if(sportH) html += `<div class="history-section-title" style="color:var(--sport-color)">ü•ã –°–ø–æ—Ä—Ç</div>${sportH}`; if(slvH) html += `<div class="history-section-title" style="color:var(--primary)">üöÄ –ó–∞–¥–∞—á–∏</div>${slvH}`; if(bogdanH) html += `<div class="history-section-title" style="color:var(--success)">üë¶ –ë–æ–≥–¥–∞–Ω</div>${bogdanH}`;
        const xpVal = document.getElementById('historyXPVal'); if(xpVal) xpVal.innerText = `${Math.floor(dayXP)} XP`; const listCon = document.getElementById('historyListContainer'); if(listCon) listCon.innerHTML = html || '<div style="text-align:center; color:#666;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
    }
    function histItem(text, xp) { return `<div class="task-item completed" style="padding:8px; margin-bottom:6px;"><span style="color:var(--success);">‚úî</span> <label style="margin-left:10px;">${text}</label> <span style="color:var(--primary);">+${xp}</span></div>`; }
    function changeHistoryDate(d) { historyDate.setDate(historyDate.getDate()+d); renderHistory(); }
    function jumpToDate(v) { if(v) { historyDate=new Date(v); renderHistory(); } }
    // --- –ü–û–î–°–ß–ï–¢ XP –ó–ê –î–ï–ù–¨ (–ò–°–ü–†–ê–í–õ–ï–ù–û) ---
    function calcDailyXP(dateStr) {
        let dXP = 0;
        
        // 1. –ó–∞–¥–∞—á–∏ (SLV + –ë–æ–≥–¥–∞–Ω)
        [...myTasks, ...bogdanTasks].forEach(t => {
            if(localStorage.getItem(`slv_${dateStr}_${t.id}`) === 'true') dXP += (t.xp || 10);
        });
        
        // 2. –í–æ–¥–∞
        const w = parseInt(localStorage.getItem(`slv_water_${dateStr}`) || '0');
        dXP += (w / 100);
        
        // 3. –í–æ–∑–¥—É—Ö
        const a = parseInt(localStorage.getItem(`slv_air_${dateStr}`) || '0');
        dXP += ((a / 15) * 5);
        
        // 4. –°–ø–æ—Ä—Ç
        sportExercises.forEach(s => {
            const c = parseInt(localStorage.getItem(`slv_sport_${dateStr}_${s.id}`) || '0');
            if(c > 0) dXP += (c * s.rate);
        });
        
        // 5. –†–∞–∑–º–∏–Ω–∫–∏
        for(let i=0; i<localStorage.length; i++) {
            const key = localStorage.key(i);
            if(key.startsWith(`slv_fizz_${dateStr}_`)) {
                const data = JSON.parse(localStorage.getItem(key));
                dXP += (data.xp || 5);
            }
        }
        
        // 6. –ü–∏—Ç–∞–Ω–∏–µ
        nutriConfig.forEach(cat => {
            const val = parseFloat(localStorage.getItem(`slv_nutri_${dateStr}_${cat.id}`) || '0');
            dXP += (val * 2);
        });
        
        // 7. –°–æ–Ω
        if (localStorage.getItem(`slv_sleep_${dateStr}`)) dXP += 10;
        
        // 8. –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Log)
        const oneOffLog = JSON.parse(localStorage.getItem(`slv_oneoff_log_${dateStr}`) || '[]');
        oneOffLog.forEach(item => { dXP += item.xp; });

        return dXP;
    }
    function updateComparison() {
        const today = new Date(); const yest = new Date(); yest.setDate(yest.getDate() - 1);
        const tStr = today.toLocaleDateString('ru-RU'); const yStr = yest.toLocaleDateString('ru-RU');
        const xpToday = calcDailyXP(tStr); const xpYest = calcDailyXP(yStr);
        const elVal = document.getElementById('compVal'); const elTxt = document.getElementById('compText'); if (!elVal) return;
        if (xpYest === 0) { if (xpToday > 0) { elVal.innerText = "üöÄ –°–¢–ê–†–¢!"; elVal.style.color = "var(--success)"; elTxt.innerText = "–í—á–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ –±—ã–ª–æ"; } else { elVal.innerText = "üò¥ Zzz..."; elVal.style.color = "#666"; elTxt.innerText = "–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"; } } else { const diff = xpToday - xpYest; const percent = ((diff / xpYest) * 100).toFixed(1); if (diff > 0) { elVal.innerText = `+${percent}% üìà`; elVal.style.color = "var(--success)"; elTxt.innerText = `–¢—ã –ª—É—á—à–µ, —á–µ–º –≤—á–µ—Ä–∞ –Ω–∞ ${Math.floor(diff)} XP`; } else if (diff < 0) { elVal.innerText = `${percent}% üìâ`; elVal.style.color = "var(--danger)"; elTxt.innerText = `–û—Ç—Å—Ç–∞–µ—à—å –æ—Ç –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –Ω–∞ ${Math.floor(Math.abs(diff))} XP`; } else { elVal.innerText = "= 0%"; elVal.style.color = "var(--warning)"; elTxt.innerText = "–ò–¥–µ—à—å —Ä–æ–≤–Ω–æ –≤ –≥—Ä–∞—Ñ–∏–∫–µ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è"; } }
    }
    function getChartData(period) { const dailyData = {}; const taskMap = {}; [...myTasks, ...bogdanTasks].forEach(t => taskMap[t.id] = t.xp); for(let i=0; i<localStorage.length; i++) { const key = localStorage.key(i); if(key.startsWith('slv_') && !key.includes('secret') && !key.includes('sleep')) { const parts = key.split('_'); if(parts.length >= 3 && !key.includes('sport') && !key.includes('fizz') && !key.includes('water') && !key.includes('air') && !key.includes('nutri') && !key.includes('energy')) { const date = parts[1]; const id = parts.slice(2).join('_'); if(localStorage.getItem(key) === 'true') dailyData[date] = (dailyData[date] || 0) + (taskMap[id] || 0); } } if(key.startsWith('slv_fizz_')) { const parts = key.split('_'); if(parts.length >= 4) { const date = parts[2]; const data = JSON.parse(localStorage.getItem(key)); dailyData[date] = (dailyData[date] || 0) + data.xp; } } if(key.startsWith('slv_nutri_')) { const parts = key.split('_'); if(parts.length >= 4) { const date = parts[2]; const val = parseFloat(localStorage.getItem(key)); if(val > 0) dailyData[date] = (dailyData[date] || 0) + (val * 2); } } } const sportMap = {}; sportExercises.forEach(s => sportMap[s.id] = s.rate); for(let i=0; i<localStorage.length; i++) { const key = localStorage.key(i); if(key.startsWith('slv_sport_')) { const parts = key.split('_'); if(parts.length >= 4) { const date = parts[2]; const id = parts.slice(3).join('_'); const count = parseInt(localStorage.getItem(key)); if(count > 0) dailyData[date] = (dailyData[date] || 0) + (count * (sportMap[id] || 0)); } } if(key.startsWith('slv_water_')) { const parts = key.split('_'); if(parts.length === 3) { const date = parts[2]; const val = parseInt(localStorage.getItem(key)); if(val>0) dailyData[date] = (dailyData[date] || 0) + (val / 100); } } if(key.startsWith('slv_air_')) { const parts = key.split('_'); if(parts.length === 3) { const date = parts[2]; const val = parseInt(localStorage.getItem(key)); if(val>0) dailyData[date] = (dailyData[date] || 0) + ((val/15)*5); } } } let days = Object.keys(dailyData).sort((a,b) => { const [d1,m1,y1] = a.split('.'); const [d2,m2,y2] = b.split('.'); return new Date(`${y1}-${m1}-${d1}`) - new Date(`${y2}-${m2}-${d2}`); }); const today = new Date(); if(period === 'month') { const cutoff = new Date(); cutoff.setDate(today.getDate() - 30); days = days.filter(d => { const [dd,mm,yyyy]=d.split('.'); return new Date(`${yyyy}-${mm}-${dd}`) >= cutoff; }); } else if(period === 'year') { const cutoff = new Date(); cutoff.setDate(today.getDate() - 365); days = days.filter(d => { const [dd,mm,yyyy]=d.split('.'); return new Date(`${yyyy}-${mm}-${dd}`) >= cutoff; }); } return { labels: days.map(d => d.slice(0,5)), values: days.map(d => dailyData[d]) }; }
    function updateChartPeriod(p, btn) { document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); renderChart(p); }
    function renderChart(p) { const ctx = document.getElementById('xpChart'); if(!ctx) return; const data = getChartData(p); if(chartInstance) chartInstance.destroy(); const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400); gradient.addColorStop(0, 'rgba(76, 201, 240, 0.5)'); gradient.addColorStop(1, 'rgba(76, 201, 240, 0.0)'); chartInstance = new Chart(ctx, { type: 'line', data: { labels: data.labels, datasets: [{ label: 'XP', data: data.values, backgroundColor: gradient, borderColor: '#4CC9F0', borderWidth: 2, fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: '#333' }, ticks: { color: '#888' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } } }); }
    window.switchTab = function(name, btn) { document.querySelectorAll('.screen').forEach(el => el.classList.remove('active')); if(btn) { document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active')); btn.classList.add('active'); } document.getElementById(`screen-${name}`).classList.add('active'); if(name === 'stats') { setTimeout(() => renderChart('month'), 100); historyDate = new Date(); renderHistory(); updateAvatarImage(); } }
</script>
</body>
</html>
